---
import { getCollection } from 'astro:content';
import ArticleLayout from '../../layouts/ArticleLayout.astro';

export async function getStaticPaths() {
  const notes = await getCollection('notes', ({ data }) => {
    return !data.draft;
  });
  return notes.map(note => ({
    params: { slug: note.slug },
    props: { note },
  }));
}

const { note } = Astro.props;
const { Content, headings } = await note.render();
const formattedDate = note.data.date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});

const base = import.meta.env.BASE_URL || '/';
const baseWithSlash = base.endsWith('/') ? base : `${base}/`;
const breadcrumbItems = [
  { label: 'Notes', href: `${baseWithSlash}notes/` },
  { label: note.data.title }
];
---

<ArticleLayout
  title={`${note.data.title} - Notes`}
  description={note.data.description}
  headings={headings}
  breadcrumbItems={breadcrumbItems}
>
  <article class="prose dark:prose-invert max-w-none">
    <header class="mb-8">
      <h1>{note.data.title}</h1>
      <div class="text-sm text-gray-600 dark:text-gray-400">
        <time datetime={note.data.date.toISOString()}>{formattedDate}</time>
        {note.data.tags && note.data.tags.length > 0 && (
          <span class="ml-4">
            {note.data.tags.map(tag => (
              <span class="inline-block bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded mr-2">
                {tag}
              </span>
            ))}
          </span>
        )}
      </div>
    </header>
    <Content />
  </article>
</ArticleLayout>
